## 날짜: 2024-05-23
### 스크럼
- 학습 목표 1 : [스크럼](https://www.notion.so/goorm/24-05-23-1288ea2fc3ad49918d3890ffe05151d2?pvs=4)

### 새로 배운 내용
#### 주제 1: Thread
- 상세 내용 1 : 스레드가 뭐고 왜 써야 하는가

멀티태스킹이 발전하면서 하나의 프로그램 내에서도 여러 작업을 동시에 처리할 필요가 생겼습니다.
이를 멀티스레딩(multi-threading)이라 합니다.
멀티스레딩을 통해 하나의 프로그램은 여러 개의 '스레드'를 생성하여 동시에 실행할 수 있습니다.

자바는 멀티스레딩을 언어 차원에서 지원하는 대표적인 언어입니다.
자바에서는 Thread 클래스를 사용하여 새로운 스레드를 만들수 있습니다.
이 클래스를 통해 병렬 처리를 쉽게 구현할 수 있습니다.

정리하면 다음과 같습니다.
- 프로그램의 실행 흐름을 나타내는 단위.
- 하나의 프로세스 안에 여러 쓰레드를 가질 수 있으며, 각 쓰레드는 독립적으로 실행될 수 있다.

스레드의 특징
- 한 스레드가 종료되어도, 다른 스레드에 영향 없음
- 같은 프로세스를 공유하는 스레드는 동일한 메모리 공간을 공유한다.
- 자바에서 스레드는 Runnable이라는 인터페이스의 구현체이다.

- 상세 내용 2 : Race condition
경쟁 상태(Race Condition): 두 개 이상의 쓰레드가 공유 자원에 접근하여 동시에 변경하려고 할 때 발생하는 상황으로, 예기치 않은 결과를 초래할 수 있음

발생 이유
- 동시성 문제: 여러 쓰레드가 동시에 실행되면서 공유 자원에 접근하고, 그로 인해 서로의 작업을 방해하거나 덮어씌우는 경우.
- 순서 보장 실패: 쓰레드가 실행되는 순서가 매번 다르기 때문에, 원하는 순서대로 작업이 처리되지 않음.

확실한 해결법
- synchronized 사용을 통한 원자성 확보
미묘한 해결법
- volatile
- semaphore

- 상세 내용 3 : synchronized
동기화(synchronization): 여러 쓰레드가 동시에 접근할 수 있는 공유 자원에 대해 일관성을 유지하기 위해, 한 번에 하나의 쓰레드만 해당 자원에 접근하도록 제어하는 것.

사용 이유
- 데이터 무결성 유지: 여러 쓰레드가 공유 자원에 동시에 접근하여 데이터를 수정할 때 발생할 수 있는 데이터 손상이나 불일치 문제를 방지.

주의점
- 동기화는 메모리 가시성 문제의 해결법이 아니다.
- 데드락 : 동기화된 코드 블록이 서로 다른 자원을 대기하며 교착 상태에 빠지지 않도록 주의해야 함.

자바의 동기화 처리 방법 
1. 메서드 동기화 스타일
메서드 전체를 동기화하여, 한 번에 하나의 쓰레드만 메서드를 실행할 수 있도록 하는 방법.

2. 블록 동기화 스타일
메서드 전체가 아닌 특정 블록만 동기화하여 성능을 향상시키는 방법.

언제 쓸 때 좋은지
1. 공유 자원 보호: 여러 쓰레드가 동시에 접근할 수 있는 변수, 객체 등의 자원에 대해 일관성을 유지해야 할 때.
2. 상호 배제(Mutual Exclusion): 특정 코드 블록을 한 번에 하나의 쓰레드만 실행하도록 해야 할 때.

- 상세내용 4: Deadlock
데드락(Deadlock)이란 여러 스레드가 서로 상대방이 소유하고 있는 자원을 기다리면서 무한 대기 상태에 빠지는 현상을 말합니다.
이러한 상태는 시스템의 성능 저하를 초래하거나 작업을 완전히 정지시킬 수 있습니다.
데드락이 발생하는 가장 기본적인 조건은 다음과 같습니다:
1. 상호 배제(Mutual Exclusion): 한 번에 하나의 스레드만 자원을 사용할 수 있어야 합니다.
    a. 자바 기준 syncronized 쓴다는 말
2. 소유하며 대기(Hold and Wait): 최소한 하나의 자원을 보유한 상태에서 다른 스레드가 소유한 자원을 추가로 요구해야 합니다.
3. 비 선점(No Preemption): 자원은 자원을 보유하고 있는 스레드가 자발적으로만 놓을 수 있어야 합니다.
멀티스레딩 환경에서 자원 관리를 설명할 때 사용되는 용어입니다.
한번 자원이 스레드에 의해 할당되면 그 스레드가 자원을 사용을 완료하고 자발적으로 자원을 방출하기 전까지는 다른 스레드나 프로세스가 그 자원을 강제로 빼앗을 수 없다는 원칙을 말합니다.
자바 기준 syncronized 블럭 끝나면 선점한 자원을 방출 (릴리즈) 한다는 뜻입니다.
4. 순환 대기(Circular Wait): 각 스레드가 순환적으로 다음 스레드가 요구하는 자원을 보유하고 있어야 합니다.
현재 스레드가 락 걸때 사용한 오브젝트를 다음 스레드가 필요로 한다는 말입니다.

- 상세내용 5 : volatile
volatile 은 자바에서 변수에 붙여 사용하는 키워드로, 메모리 가시성 문제를 해결 할 수 있는 예약어다.

사용 이유
- 가시성 보장: 한 쓰레드가 변경한 변수의 값을 다른 쓰레드가 즉시 볼 수 있도록 보장.
- 메모리 일관성 유지: CPU 캐시를 사용하지 않고, 메모리에 직접 접근하여 값을 읽고 쓰도록 강제함.

언제 사용할지
1. 간단한 상태 플래그: 쓰레드 간의 간단한 플래그나 상태 변수를 공유할 때.
2. 읽기-쓰기 작업이 적은 경우: 읽기와 쓰기 작업이 자주 발생하지 않을 때.

-> volatile은 속도가 빠른 캐시를 포기하고 더 느린 메모리를 참조하므로, 성능이 처참하다. 필요할 때만 사용해야 한다.

주의 사항
원자성 보장하지 않음:
volatile 키워드는 변수의 원자성을 보장하지 않음.
    원자성을 보장하지 않기 때문에 증가 연산과 같은 복합 연산은 여전히 동기화가 필요함.

    volatile 은 메모리 가시성 문제를 해결 하는 것이 주 목적이지 레이스 컨디션을 완벽하게 해결하는 키워드가 아님에 주의하자

- 상세 내용 6: semaphore
세마포어(Semaphore)는 멀티스레드 환경에서 동기화 문제를 해결하기 위한 기술 중 하나입니다.
주로 스레드들이 공유 자원을 안전하게 접근할 수 있도록 하는 역할을 합니다.
세마포어는 내부적으로 정수값을 가지고 있으며, 이 값에 따라 자원 접근을 제어합니다.

사용 이유
멀티스레드 프로그래밍에서는 여러 스레드가 동시에 자원에 접근할 때 데이터의 일관성이 깨지거나 예상치 못한 동작이 발생할 수 있습니다. 이를 방지하기 위해 세마포어를 사용하여 스레드들이 자원에 접근할 수 있는 수를 제한하고, 안전하게 동기화할 수 있습니다.

언제 쓸 때 좋은지
세마포어는 다음과 같은 상황에서 유용합니다:
    제한된 수의 자원(예: 데이터베이스 연결, 네트워크 소켓 등)에 대해 접근을 제어할 때
    특정 자원에 대해 동시에 접근 가능한 스레드 수를 제한하고 싶을 때
    스레드 간의 순서를 제어하거나 동기화 포인트를 설정할 때
    리스트 길이가 수 천만건 이상인 경우 해당 리스트를 청킹 후 (자른후) 스레드에 안배해서 작업해야 할 때
    CPU 갯수 고려해서 스레드 생성하는 것이 좋다.


### 오늘의 회고
운영체제와 시스템 프로그래밍 전공 과목에서나 듣던 내용을 c가 아나리 java로는 처음 접해서 흥미로웠다. 다만 이상하게 세마포어는 학부시절이나 지금이나 들으면 잠이 오는지 이해가 안 간다.

### 참고 자료 및 링크
- [교재](https://edu.startupcode.kr/7021d3cd-28eb-43fa-94ff-42937d66c6e4)
